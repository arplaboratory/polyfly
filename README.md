# PolyFly: Polytopic Optimal Planning for Collision-Free Cable-Suspended Aerial Payload Transportation

PolyFly is an optimal global planner for aerial transportation with a cable-suspended payload. Unlike conservative geometric over-approximations, PolyFly models each physical component—quadrotor, cable, and payload—as distinct polytopes, and incorporates orientation-aware geometry. Using duality, polytopic collision constraints are converted into smooth differentiable constraints, enabling efficient optimization and aggressive, collision-free trajectories in cluttered environments.

For the full method, results, and hardware validation, see the paper: [PolyFly: Polytopic Optimal Planning for Collision-Free Cable-Suspended Aerial Payload Transportation](https://arxiv.org/pdf/2510.15226).

---

## Highlights

- Non-conservative, orientation-aware polytopic modeling of quadrotor, cable, and payload
- Smooth differentiable collision constraints via duality for efficient optimization
- Global trajectories for maze-like, tightly constrained environments
- Real-world validation with low tracking error and agile maneuvers

---

## Repository Structure

- `src/poly_fly/optimal_planner/`: Core global planner and collision constraints
- `src/poly_fly/forest_planner/`: Synthetic environment generation, viewers, and video utilities
- `data/params/`: Parameter files for environments and studies
- `data/csvs/`: Generated environments (forests and mazes) produced by the code
- `scripts/`: Convenience scripts for running planner and generating environments

---

## Important Notes 
- By default, the code uses the MA57 solver. This is significantly faster than the default solvers. Refer to README_INSTALL_HSL on how to set this up. If you are unable to get access to this solver, comment out `ipopt.linear_solver": "ma57` in planner.py.

## Quick Start (Docker)

Add the following to your .bashrc
`export POLYFLY_DIR= <directory that contains polyfly>`

Use Docker for the fastest setup and consistent environment:

1) Build the image
```bash
docker build -t poly-fly:latest .
```

2) Start the container
```bash
./scripts/docker_run_dev.sh
```

This mounts your workspace at `/workspace` inside the container so edits on your host are immediately reflected inside the container.

3) Create a `.env` at the project root with your OpenAI API key (optional if not using features that need it)
```txt
OPENAI_API_KEY="my-openai-api-key"
```

4) Inside the container, run commands
```bash
# Run the optimal planner (with plots)
./scripts/run_planner.sh --plot

# Generate forests
./scripts/run_generate_forest.sh -n 5 --forest-type 0 --plot

# Generate an environment through GPT!
./scripts/run_interactive_forest.sh

# When prompted, enter the description of the environment you'd like to create. For example, you can say 
#'Use 10 small obstacles to create a letter X'
# Refer to compose_gpt_prompt in interactive_generate_forest.py for information on the prompt engineering

# Or run Python commands directly:
cd /workspace
python src/poly_fly/optimal_planner/planner.py --plot
```

Generate a obstacle course using a ChatGPT!
```bash
./scripts/run_interactive_forest.sh

# When prompted, enter the description of the environment you'd like to create. For example, you can say 
#'Use 10 small obstacles to create a letter X'
# Refer to compose_gpt_prompt in interactive_generate_forest.py for information on the prompt engineering
```

5) Exit the container
```bash
exit
```

Optional: some solvers may require HSL. See `README_INSTALL_HSL.md` for instructions.

---

## Docker Notes

- The container bind-mounts your project at `/workspace` for live-edit development.
- Place an optional `.env` at the repo root if you need the OpenAI key.

## Datasets and Environments

- Maze and forest CSVs are generated by the code and saved to `data/csvs/`.
- Parameter files to configure obstacles, robot, and planner are in `data/params/`.
- To procedurally create forests, use `./scripts/run_generate_forest.sh` or `src/poly_fly/forest_planner/generate_forest.py`.

To reproduce maze-like environments similar to the paper, use the parameter sets in `data/params/autotrans/` and `data/params/long_range/`. You can point the planner to a specific parameter file via the provided scripts or by passing flags to the Python entrypoints.

---

## Reproducing Paper-Style Results

1. Generate an environment CSV (files are written to `data/csvs/`).
2. Choose a matching parameter file from `data/params/` directories.
3. Run the planner with plotting enabled to visualize trajectories.
4. Use `src/poly_fly/forest_planner/create_video.py` to render videos if needed.

Hardware notes: The paper’s real-world experiments track global trajectories with an onboard NMPC at 200 Hz and send thrust/bodyrates to PX4; motion capture provides state estimates upsampled by onboard filters (see [arXiv PDF](https://arxiv.org/pdf/2510.15226)).

---

## Citation

If you use this repository or build on PolyFly, please cite:

```bibtex
@article{Sarvaiya2025PolyFly,
  title   = {PolyFly: Polytopic Optimal Planning for Collision-Free Cable-Suspended Aerial Payload Transportation},
  author  = {Mrunal Sarvaiya and Guanrui Li and Giuseppe Loianno},
  journal = {arXiv preprint arXiv:2510.15226},
  year    = {2025},
  url     = {https://arxiv.org/pdf/2510.15226}
}
```

---

## Acknowledgements

This codebase builds upon optimization tooling such as CasADi and standard nonlinear optimization methods. For GPU-accelerated collision avoidance and related works, see references in the paper, including [arXiv PDF](https://arxiv.org/pdf/2510.15226).

For HSL solver installation guidance, see `README_INSTALL_HSL.md`.
# polyfly
